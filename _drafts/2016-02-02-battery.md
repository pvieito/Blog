---
layout: post
title: Reverse Engineering a Smart Battery
---

I wanted to investigate an old battery from a Toshiba laptop I had laying around. These batteries are usually called *smart batteries* as they can monitor the temperature, count the recharging cycles or detect the actual charge of the battery cells.

### Disassembly

So to take a look at it I followed the [Dave Jones](http://www.eevblog.com) method: “Don't turn it on, take it apart!”. First I opened the battery and extracted the different cells it had inside.

![](/media/2016/02/battery-closed.jpg)

The battery is composed of 6 unique [Panasonic Lithium Ion NCR18650](http://industrial.panasonic.com/cdbs/www-data/pdf2/ACA4000/ACA4000CE240.pdf) batteries connected two by two in parallel forming three independent cells connected in series. As each battery has a nominal voltage of 3.6 V the total voltage of the smart battery is 10.8 V.

![](/media/2016/02/battery-opened.jpg)

The connector of the battery has 7 pins, the biggest ones at the extremes are the power pins.

![](/media/2016/02/battery-pinout.jpg)

The core of the smart battery is an Advanced Smart Battery-Pack Controller, the MAX1781.

![](/media/2016/02/max1781-chip.jpg)

To talk with this microcontroller we have to use the SMBus protocol, a subset of the I²C bus. As I didn’t have the main board of the laptop I couldn’t sniff the connections through the different pins of the connector.

### MAX1781 Architecture

![](/media/2016/02/max1781-architecture.png)

### Smart Battery Protocol

![](/media/2016/02/reverse-engineering.jpg)
